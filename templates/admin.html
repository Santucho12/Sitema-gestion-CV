<link rel="stylesheet" href="{{ url_for('static', filename='stylesAdmin.css') }}" />
    <button id="darkModeBtn" class="btn" style="position:fixed;top:20px;right:20px;z-index:2000;">üåô Modo oscuro</button>
    <h1 class="titulo">Panel de administracion de postulantes</h1>
    <div style="height: 24px;"></div>
    <div style="width:100%; display:flex; justify-content:center; align-items:center; gap:0px; margin-bottom:0; margin-top:110px;">
        <input type="text" id="filtroNombre" placeholder="filtrar por nombre" style="font-size:12px; border:2px solid #222; background:#fff; color:#222; padding:4px 0px; border-radius:4px; margin-right:0px; text-align:center;">
        <input type="text" id="filtroApellido" placeholder="Filtrar por apellido" style="font-size:12px; border:2px solid #222; background:#fff; color:#222; padding:4px 0px; border-radius:4px; margin-right:850px; text-align:center;">
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>foto</th>
                <th>nombre</th>
                <th>apellido</th>
                <th class="sortable" data-col="4">sexo</th>
                <th class="sortable" data-col="5">Edad</th>
                <th>direcci√≥n</th>
                <th class="sortable" data-col="7">estado civil</th>
                <th class="sortable" data-col="8">disponibilidad horaria</th>
                <th>tipo de formaci√≥n</th>
                <th class="sortable" data-col="10">curso manipulaci√≥n alimentos</th>
                <th class="sortable" data-col="11">atenci√≥n al p√∫blico</th>
                <th class="sortable" data-col="12">experiencia en producci√≥n</th>
                <th>conocimientos de producci√≥n</th>
                <th class="sortable" data-col="14">experiencia administrativa</th>
                <th class="sortable" data-col="15">experiencia en reparto</th>
                <th class="sortable" data-col="16">nivel excel</th>
                <th class="sortable" data-col="17">licencia de auto</th>
                <th class="sortable" data-col="18">movilidad propia</th>
                <th>curr√≠culum</th>
                <th class="sortable" data-col="21">calificaci√≥n</th>
                <th>Eliminar</th>
            </tr>
        </thead>
        <tbody>

            <!-- ejemplo 1 -->
            <tr>
                <td>1</td>
                <td>
                    <a class="btn" href="/admin/uploads/depositphotos_34527159-stock-photo-woman-with-tablet.jpg" target="_blank">ver foto</a>
                </td>
                <td>maria</td>
                <td>gonzalez</td>
                <td>femenino</td>
                <td>53</td>
                <td><div class="scrollable-cell">av. san mart√≠n 123</div></td>
                <td>soltera</td>
                <td>full time</td>
                <td>universitaria</td>
                <td>s√≠</td>
                <td>s√≠</td>
                <td>s√≠</td>
                <td><div class="scrollable-cell">producci√≥n de panificados y facturas</div></td>
                <td>s√≠</td>
                <td>no</td>
                <td>avanzado</td>
                <td>s√≠</td>
                <td>no</td>
                <td><a class="btn" href="/admin/uploads/franco_gonzalez_CV%20Santiago%20Segal(C%23).pdf" target="_blank">ver cv</a></td>
                <td class="rating" data-id="1" data-value="0"></td>
                <td>
                    <form method="POST" action="/eliminar_postulante" style="display:inline;">
                        <input type="hidden" name="id" value="1">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('¬øSeguro que quieres eliminar este postulante?');">Eliminar</button>
                    </form>
                </td>
            </tr>

            <!-- ejemplo 2 -->
            <tr>
                <td>2</td>
                <td>
                    <a class="btn" href="/admin/uploads/depositphotos_34527159-stock-photo-woman-with-tablet.jpg" target="_blank">ver foto</a>
                </td>
                <td>juan</td>
                <td>perez</td>
                <td>masculino</td>
                <td>32</td>
                <td><div class="scrollable-cell">calle 11 buenos aires argentina, mitad de cuadra puerta marron lalalallalalalalalalaaaaaaaaaaaaaaaaaaaaaa</div></td>
                <td>casado</td>
                <td>part time</td>
                <td>secundaria</td>
                <td>no</td>
                <td>no</td>
                <td>s√≠</td>
                <td><div class="scrollable-cell">elaboraci√≥n de masas y facturas, trabaje por 10 a√±os haciendo cosas de panaderia lalalalalallalalallalalallalalalalallalalallalalalallalalalelaboraci√≥n de masas y facturas, trabaje por 10 a√±os haciendo cosas de panaderia.</div></td>
                <td>no</td>
                <td>s√≠</td>
                <td>b√°sico</td>
                <td>no</td>
                <td>s√≠</td>
                <td><a class="btn" href="/admin/uploads/franco_gonzalez_CV%20Santiago%20Segal(C%23).pdf" target="_blank">ver cv</a></td>
                <td class="rating" data-id="2" data-value="0"></td>
                <td>
                    <form method="POST" action="/eliminar_postulante" style="display:inline;">
                        <input type="hidden" name="id" value="2">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('¬øSeguro que quieres eliminar este postulante?');">Eliminar</button>
                    </form>
                </td>
            </tr>
            <tr>
                <td>4</td>
                <td>
                    <a class="btn" href="/admin/uploads/depositphotos_34527159-stock-photo-woman-with-tablet.jpg" target="_blank">ver foto</a>
                </td>
                <td>juan</td>
                <td>perez</td>
                <td>masculino</td>
                <td>28</td>
                <td><div class="scrollable-cell">calle falsa 456</div></td>
                <td>casado</td>
                <td>part time</td>
                <td>secundaria</td>
                <td>no</td>
                <td>no</td>
                <td>s√≠</td>
                <td><div class="scrollable-cell">elaboraci√≥n de masas y boller√≠a</div></td>
                <td>no</td>
                <td>s√≠</td>
                <td>b√°sico</td>
                <td>no</td>
                <td>s√≠</td>
                <td><a class="btn" href="/admin/uploads/franco_gonzalez_CV%20Santiago%20Segal(C%23).pdf" target="_blank">ver cv</a></td>
                <td class="rating" data-id="4" data-value="0"></td>
                <td>
                    <form method="POST" action="/eliminar_postulante" style="display:inline;">
                        <input type="hidden" name="id" value="4">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('¬øSeguro que quieres eliminar este postulante?');">Eliminar</button>
                    </form>
                </td>
            </tr>
            <tr>
                <td>3</td>
                <td>
                    <a class="btn" href="/admin/uploads/depositphotos_34527159-stock-photo-woman-with-tablet.jpg" target="_blank">ver foto</a>
                </td>
                <td>martin</td>
                <td>gonzalez</td>
                <td>masculino</td>
                <td>41</td>
                <td><div class="scrollable-cell">calle falsa 456</div></td>
                <td>casado</td>
                <td>part time</td>
                <td>secundaria</td>
                <td>no</td>
                <td>no</td>
                <td>s√≠</td>
                <td><div class="scrollable-cell">elaboraci√≥n de masas y boller√≠a</div></td>
                <td>no</td>
                <td>s√≠</td>
                <td>b√°sico</td>
                <td>no</td>
                <td>s√≠</td>
                <td><a class="btn" href="/admin/uploads/franco_gonzalez_CV%20Santiago%20Segal(C%23).pdf" target="_blank">ver cv</a></td>
                <td class="rating" data-id="3" data-value="0"></td>
                <td>
                    <form method="POST" action="/eliminar_postulante" style="display:inline;">
                        <input type="hidden" name="id" value="3">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('¬øSeguro que quieres eliminar este postulante?');">Eliminar</button>
                    </form>
                </td>
            </tr>

        </tbody>
    </table>
    </div>






        <script>
        // Filtro por nombre y apellido
        function filtrarTabla() {
            const nombre = document.getElementById('filtroNombre').value.trim().toLowerCase();
            const apellido = document.getElementById('filtroApellido').value.trim().toLowerCase();
            document.querySelectorAll('table tbody tr').forEach(row => {
                const nombreCelda = row.children[2].textContent.trim().toLowerCase();
                const apellidoCelda = row.children[3].textContent.trim().toLowerCase();
                let mostrar = true;
                if (nombre && !nombreCelda.includes(nombre)) mostrar = false;
                if (apellido && !apellidoCelda.includes(apellido)) mostrar = false;
                row.style.display = mostrar ? '' : 'none';
            });
        }
        document.getElementById('filtroNombre').addEventListener('input', filtrarTabla);
        document.getElementById('filtroApellido').addEventListener('input', filtrarTabla);
        document.getElementById('darkModeBtn').addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            this.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è Modo claro' : 'üåô Modo oscuro';
        });

        document.querySelectorAll('.rating').forEach(cell => {
                const stars = 5;
                let value = parseInt(cell.dataset.value) || 0;
                cell.innerHTML = '';
                for (let i = 1; i <= stars; i++) {
                    const star = document.createElement('span');
                    star.textContent = '‚òÖ';
                    star.dataset.value = i;
                    star.style.cursor = 'pointer';
                    star.style.color = i <= value ? '#ffc107' : '#999';
                    star.addEventListener('mouseover', () => highlight(cell, i));
                    star.addEventListener('mouseout', () => highlight(cell, value));
                    star.addEventListener('click', () => {
                        value = i;
                        cell.dataset.value = value;
                        highlight(cell, value);
                        console.log(`Postulante ${cell.dataset.id} calificado con ${value} estrellas`);
                    });
                    cell.appendChild(star);
                }
            });

            function highlight(cell, val) {
                const stars = cell.querySelectorAll('span');
                stars.forEach((star, index) => {
                    star.style.color = index < val ? '#ffc107' : '#999';
                });
            }

            // Ordenar por ID de forma descendente al cargar la p√°gina
            document.addEventListener('DOMContentLoaded', function() {
                const tbody = document.querySelector('table tbody');
                const rows = Array.from(tbody.querySelectorAll('tr'));
                rows.sort((a, b) => {
                    const aId = parseInt(a.children[0].textContent) || 0;
                    const bId = parseInt(b.children[0].textContent) || 0;
                    return bId - aId;
                });
                rows.forEach(row => tbody.appendChild(row));
            });

            // Alternar orden ascendente/descendente solo en columnas 'sortable'
            let sortState = {};
            document.querySelectorAll('th.sortable').forEach(th => {
                th.addEventListener('click', function() {
                    const colIndex = parseInt(th.getAttribute('data-col'));
                    const tbody = th.closest('table').querySelector('tbody');
                    const rows = Array.from(tbody.querySelectorAll('tr'));

                    // Invert initial sort direction: first click is descending
                    if (sortState[colIndex] === undefined) {
                        sortState[colIndex] = true; // true = descending first
                    } else {
                        sortState[colIndex] = !sortState[colIndex];
                    }
                    const isDesc = sortState[colIndex];

                    let sortFn;
                    if (colIndex === 21) { // calificaci√≥n
                        sortFn = (a, b) => {
                            const aVal = parseInt(a.querySelector('.rating').dataset.value) || 0;
                            const bVal = parseInt(b.querySelector('.rating').dataset.value) || 0;
                            return isDesc ? bVal - aVal : aVal - bVal;
                        };
                    } else {
                        sortFn = (a, b) => {
                            const aVal = a.children[colIndex].textContent.trim().toLowerCase();
                            const bVal = b.children[colIndex].textContent.trim().toLowerCase();
                            const aNum = parseFloat(aVal);
                            const bNum = parseFloat(bVal);
                            if (!isNaN(aNum) && !isNaN(bNum) && aVal !== '' && bVal !== '') {
                                return isDesc ? bNum - aNum : aNum - bNum;
                            }
                            return isDesc ? bVal.localeCompare(aVal) : aVal.localeCompare(bVal);
                        };
                    }
                    rows.sort(sortFn);
                    rows.forEach(row => tbody.appendChild(row));
                });
            });

            const popup = document.getElementById('image-popup');
            const popupImg = popup.querySelector('img');
            document.querySelectorAll('.preview-btn').forEach(btn => {
                btn.addEventListener('mouseenter', e => {
                    const imgSrc = btn.getAttribute('data-img');
                    popupImg.src = imgSrc;
                    popup.style.display = 'block';
                    const rect = btn.getBoundingClientRect();
                    popup.style.top = (rect.bottom + window.scrollY + 5) + 'px';
                    popup.style.left = (rect.left + window.scrollX) + 'px';
                });
                btn.addEventListener('mouseleave', () => {
                    popup.style.display = 'none';
                    popupImg.src = '';
                });
            });
        </script>

    </body>

    </html>
